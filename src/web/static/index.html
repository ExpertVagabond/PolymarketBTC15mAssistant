<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PolySignal</title>
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#101018">
  <link rel="icon" href="/icon-192.svg" type="image/svg+xml">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif; background: #0b0b11; color: #c8c8d0; min-height: 100vh; line-height: 1.5; }

    /* ── Header ── */
    .header { padding: 14px 28px; background: #101018; border-bottom: 1px solid #1e1e2a; display: flex; align-items: center; justify-content: space-between; }
    .header-left { display: flex; align-items: center; gap: 14px; }
    .header-left h1 { font-size: 17px; color: #fff; font-weight: 700; letter-spacing: -0.3px; }
    .conn-badge { display: flex; align-items: center; gap: 6px; font-size: 11px; padding: 3px 10px; border-radius: 20px; background: #1a1a24; border: 1px solid #2a2a36; }
    .conn-dot { width: 6px; height: 6px; border-radius: 50%; background: #333; flex-shrink: 0; }
    .conn-dot.live { background: #34d399; box-shadow: 0 0 6px #34d39966; animation: pulse 2.5s ease-in-out infinite; }
    @keyframes pulse { 0%,100% { opacity:1 } 50% { opacity:0.4 } }
    .freshness-badge { font-size: 10px; color: #34d399; font-weight: 600; }
    .freshness-badge.stale { color: #fbbf24; }
    .freshness-badge.critical { color: #f87171; }
    .header-right { display: flex; align-items: center; gap: 14px; }
    .header-link { color: #6b7280; text-decoration: none; font-size: 12px; font-weight: 500; }
    .header-link:hover { color: #a5b4fc; }

    /* ── Summary strip ── */
    .summary-strip { display: flex; align-items: center; gap: 0; padding: 0 28px; background: #0e0e16; border-bottom: 1px solid #1a1a24; }
    .summary-item { padding: 10px 20px 10px 0; font-size: 12px; color: #6b7280; display: flex; align-items: center; gap: 6px; border-right: 1px solid #1a1a24; }
    .summary-item:last-child { border-right: none; }
    .summary-item:first-child { padding-left: 0; }
    .summary-val { color: #e5e7eb; font-weight: 600; font-variant-numeric: tabular-nums; }
    .summary-val.highlight { color: #34d399; }

    /* ── Signals panel ── */
    .signals-panel { padding: 20px 28px; }
    .section-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px; }
    .section-title { font-size: 13px; font-weight: 700; color: #e5e7eb; text-transform: uppercase; letter-spacing: 0.8px; }
    .signal-count-badge { font-size: 11px; font-weight: 700; padding: 2px 10px; border-radius: 20px; background: #34d39920; color: #34d399; }
    .signal-count-badge.zero { background: #374151; color: #6b7280; }

    .signal-explainer { font-size: 11px; color: #4b5563; margin-bottom: 14px; padding: 10px 14px; background: #111119; border: 1px solid #1e1e2a; border-radius: 6px; line-height: 1.6; }
    .signal-explainer strong { color: #9ca3af; }

    .signal-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 10px; }

    .sig-card { background: #12121a; border: 1px solid #1e1e2a; border-radius: 10px; padding: 16px 18px; position: relative; overflow: hidden; transition: border-color 0.2s; }
    .sig-card::before { content: ""; position: absolute; top: 0; left: 0; width: 3px; height: 100%; }
    .sig-card.side-yes::before { background: #34d399; }
    .sig-card.side-no::before { background: #f87171; }
    .sig-card.str-strong { border-color: #f8717140; }
    .sig-card.str-good { border-color: #fbbf2440; }

    .sig-top { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
    .sig-action { font-size: 13px; font-weight: 700; display: flex; align-items: center; gap: 6px; }
    .sig-action.yes { color: #34d399; }
    .sig-action.no { color: #f87171; }
    .sig-badge { font-size: 9px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; padding: 2px 8px; border-radius: 4px; }
    .sig-badge.strong { background: #f8717125; color: #fca5a5; }
    .sig-badge.good { background: #fbbf2420; color: #fcd34d; }
    .sig-badge.moderate { background: #3b82f620; color: #93c5fd; }

    .sig-question { font-size: 13px; color: #d1d5db; font-weight: 500; line-height: 1.4; margin-bottom: 10px; }

    .sig-metrics { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 8px; }
    .sig-metric { text-align: center; }
    .sig-metric-label { font-size: 9px; text-transform: uppercase; letter-spacing: 0.5px; color: #4b5563; margin-bottom: 2px; }
    .sig-metric-value { font-size: 14px; font-weight: 700; font-variant-numeric: tabular-nums; }
    .sig-metric-value.green { color: #34d399; }
    .sig-metric-value.red { color: #f87171; }
    .sig-metric-value.amber { color: #fbbf24; }

    .sig-explain { font-size: 11px; color: #6b7280; margin-top: 10px; padding-top: 10px; border-top: 1px solid #1a1a24; line-height: 1.5; }
    .sig-explain em { color: #9ca3af; font-style: normal; font-weight: 500; }

    .no-signals-box { text-align: center; padding: 32px 20px; color: #374151; }
    .no-signals-box .icon { font-size: 28px; margin-bottom: 8px; }
    .no-signals-box p { font-size: 13px; }
    .no-signals-box p strong { color: #6b7280; }

    /* ── Filter bar ── */
    .filter-bar { display: flex; gap: 6px; padding: 6px 28px 14px; flex-wrap: wrap; }
    .fbtn { background: #14141e; border: 1px solid #1e1e2a; border-radius: 6px; padding: 5px 12px; font-size: 11px; color: #6b7280; cursor: pointer; font-family: inherit; font-weight: 500; transition: all 0.15s; }
    .fbtn:hover { border-color: #3b82f6; color: #93c5fd; }
    .fbtn.active { background: #3b82f618; border-color: #3b82f6; color: #60a5fa; }

    /* ── Markets table ── */
    .table-section { padding: 0 28px 32px; }
    .table-section .section-header { margin-bottom: 10px; }
    .table-wrap { border: 1px solid #1e1e2a; border-radius: 8px; overflow: hidden; }
    table { width: 100%; border-collapse: collapse; font-size: 12px; }
    thead th { text-align: left; padding: 10px 12px; color: #4b5563; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; font-size: 10px; background: #0e0e16; border-bottom: 1px solid #1e1e2a; }
    tbody tr { border-bottom: 1px solid #141420; transition: background 0.1s; }
    tbody tr:last-child { border-bottom: none; }
    tbody tr:hover { background: #14141e; }
    tbody tr.row-signal { background: #34d39908; }
    tbody tr.row-signal:hover { background: #34d39912; }
    td { padding: 9px 12px; font-variant-numeric: tabular-nums; }

    .cat-pill { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; }
    .cat-bitcoin { background: #f9731618; color: #fb923c; }
    .cat-ethereum { background: #818cf818; color: #a5b4fc; }
    .cat-upordown, .cat-15m, .cat-hidefromnew { background: #6366f118; color: #818cf8; }
    .cat-sports { background: #34d39918; color: #6ee7b7; }
    .cat-esports { background: #a78bfa18; color: #c4b5fd; }
    .cat-tennis { background: #34d39918; color: #6ee7b7; }
    .cat-politics { background: #f8717118; color: #fca5a5; }
    .cat-crypto { background: #fbbf2418; color: #fcd34d; }
    .cat-other { background: #37415118; color: #6b7280; }

    .sig-cell { font-weight: 600; white-space: nowrap; }
    .sig-cell.active { color: #34d399; }
    .sig-cell.inactive { color: #27272f; }

    .edge-bar { display: inline-flex; align-items: center; gap: 4px; }
    .edge-fill { height: 6px; border-radius: 3px; min-width: 2px; }
    .edge-fill.pos { background: #34d399; }
    .edge-fill.neg { background: #f87171; }

    .price-pair { white-space: nowrap; }
    .price-yes { color: #34d399; }
    .price-no { color: #f87171; }
    .price-sep { color: #27272f; margin: 0 2px; }

    .liq-val { color: #6b7280; }
    .time-val { color: #6b7280; white-space: nowrap; }
    .time-val.urgent { color: #fbbf24; }
    .time-val.imminent { color: #f87171; }

    /* ── Signal card badges (confluence, volatility, correlation) ── */
    .conf-badge { font-size: 9px; font-weight: 700; padding: 2px 7px; border-radius: 4px; margin-left: 4px; background: #3b82f618; color: #60a5fa; }
    .conf-badge.conf-3 { background: #34d39920; color: #34d399; }
    .conf-badge.conf-2 { background: #3b82f618; color: #60a5fa; }
    .conf-badge.conf-1 { background: #37415118; color: #6b7280; }
    .conf-badge.conf-0 { background: #f8717118; color: #fca5a5; }

    .vol-badge { font-size: 9px; font-weight: 600; padding: 2px 7px; border-radius: 4px; margin-left: 4px; }
    .vol-badge.vol-lowvol { background: #60a5fa18; color: #93c5fd; }
    .vol-badge.vol-normalvol { background: #37415118; color: #6b7280; }
    .vol-badge.vol-highvol { background: #f8717118; color: #fca5a5; }

    .corr-note { font-size: 9px; font-weight: 600; padding: 2px 7px; border-radius: 4px; margin-left: 4px; background: #fbbf2418; color: #fcd34d; }

    /* ── Table vol/conf pills ── */
    .vol-pill { font-size: 9px; font-weight: 600; padding: 1px 6px; border-radius: 3px; }
    .vol-pill.low { background: #60a5fa18; color: #93c5fd; }
    .vol-pill.normal { background: #37415118; color: #4b5563; }
    .vol-pill.high { background: #f8717118; color: #fca5a5; }
    .conf-pill { font-size: 9px; font-weight: 600; padding: 1px 6px; border-radius: 3px; }
    .conf-pill.c3 { background: #34d39918; color: #34d399; }
    .conf-pill.c2 { background: #3b82f618; color: #60a5fa; }
    .conf-pill.c1 { background: #37415118; color: #6b7280; }
    .conf-pill.c0 { background: #f8717118; color: #fca5a5; }

    /* ── Confidence bar (signal cards) ── */
    .confidence-bar { height: 4px; background: #1a1a24; border-radius: 2px; margin-bottom: 10px; position: relative; overflow: hidden; }
    .confidence-fill { height: 100%; border-radius: 2px; transition: width 0.4s ease; }
    .confidence-fill.conf-high { background: #34d399; }
    .confidence-fill.conf-med { background: #60a5fa; }
    .confidence-fill.conf-low { background: #fbbf24; }
    .confidence-fill.conf-vlow { background: #f87171; }
    .confidence-label { position: absolute; right: 0; top: -14px; font-size: 9px; color: #4b5563; }

    .confidence-pill { font-size: 10px; font-weight: 700; padding: 2px 6px; border-radius: 4px; margin-left: 4px; }
    .confidence-pill.conf-high { background: #34d39920; color: #34d399; }
    .confidence-pill.conf-med { background: #3b82f618; color: #60a5fa; }
    .confidence-pill.conf-low { background: #fbbf2418; color: #fbbf24; }
    .confidence-pill.conf-vlow { background: #f8717118; color: #f87171; }

    .confidence-pill-sm { font-size: 9px; font-weight: 700; padding: 1px 5px; border-radius: 3px; }
    .confidence-pill-sm.conf-high { background: #34d39918; color: #34d399; }
    .confidence-pill-sm.conf-med { background: #3b82f618; color: #60a5fa; }
    .confidence-pill-sm.conf-low { background: #fbbf2418; color: #fbbf24; }
    .confidence-pill-sm.conf-vlow { background: #f8717118; color: #f87171; }

    /* ── Order flow badges ── */
    .flow-badge { font-size: 9px; font-weight: 600; padding: 2px 7px; border-radius: 4px; margin-left: 4px; }
    .flow-badge.flow-pos { background: #34d39918; color: #34d399; }
    .flow-badge.flow-neg { background: #f8717118; color: #fca5a5; }
    .flow-badge.flow-neutral { background: #37415118; color: #6b7280; }
    .flow-pill { font-size: 9px; font-weight: 600; padding: 1px 6px; border-radius: 3px; }
    .flow-pill.pos { background: #34d39918; color: #34d399; }
    .flow-pill.neg { background: #f8717118; color: #fca5a5; }
    .flow-cell { white-space: nowrap; }

    /* ── Signal card meta row ── */
    .sig-meta { display: flex; gap: 12px; font-size: 10px; color: #4b5563; margin-top: 8px; flex-wrap: wrap; }
    .sig-meta-item em { color: #9ca3af; font-style: normal; font-weight: 500; }

    /* ── Notify button ── */
    .notify-btn { background: #14141e; border: 1px solid #1e1e2a; border-radius: 6px; padding: 4px 10px; font-size: 11px; font-weight: 600; color: #6b7280; cursor: pointer; font-family: inherit; transition: all 0.15s; }
    .notify-btn:hover { border-color: #fbbf24; color: #fbbf24; }
    .notify-btn.active { background: #fbbf2418; border-color: #fbbf24; color: #fbbf24; }

    /* ── Signal detail modal ── */
    .modal-overlay { position: fixed; inset: 0; background: #00000080; z-index: 100; display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: opacity 0.2s; }
    .modal-overlay.open { opacity: 1; pointer-events: auto; }
    .modal { background: #12121a; border: 1px solid #2a2a36; border-radius: 12px; width: 90%; max-width: 560px; max-height: 85vh; overflow-y: auto; padding: 24px; }
    .modal-close { float: right; background: none; border: none; color: #4b5563; font-size: 18px; cursor: pointer; padding: 0 4px; line-height: 1; }
    .modal-close:hover { color: #e5e7eb; }
    .modal h3 { font-size: 15px; color: #fff; font-weight: 700; margin-bottom: 4px; }
    .modal .modal-sub { font-size: 11px; color: #6b7280; margin-bottom: 16px; }
    .modal-section { margin-bottom: 16px; }
    .modal-section-title { font-size: 10px; font-weight: 700; color: #4b5563; text-transform: uppercase; letter-spacing: 0.6px; margin-bottom: 8px; }
    .breakdown-row { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
    .breakdown-label { font-size: 11px; color: #9ca3af; width: 110px; flex-shrink: 0; }
    .breakdown-bar { flex: 1; height: 6px; background: #1a1a24; border-radius: 3px; overflow: hidden; }
    .breakdown-fill { height: 100%; border-radius: 3px; transition: width 0.3s; }
    .breakdown-fill.green { background: #34d399; }
    .breakdown-fill.blue { background: #60a5fa; }
    .breakdown-fill.amber { background: #fbbf24; }
    .breakdown-fill.red { background: #f87171; }
    .breakdown-val { font-size: 11px; color: #e5e7eb; font-weight: 600; width: 42px; text-align: right; font-variant-numeric: tabular-nums; }
    .modal-kv { display: flex; justify-content: space-between; padding: 4px 0; border-bottom: 1px solid #141420; font-size: 12px; }
    .modal-kv:last-child { border-bottom: none; }
    .modal-kv .k { color: #4b5563; }
    .modal-kv .v { color: #e5e7eb; font-weight: 500; }

    /* ── Tab buttons ── */
    .tab-btn { background: none; border: 1px solid transparent; border-radius: 6px; padding: 4px 12px; font-size: 12px; font-weight: 600; color: #6b7280; cursor: pointer; font-family: inherit; transition: all 0.15s; }
    .tab-btn:hover { color: #a5b4fc; border-color: #3b82f630; }
    .tab-btn.active { background: #3b82f618; border-color: #3b82f6; color: #60a5fa; }

    /* ── Feature gate overlay ── */
    .gated { position: relative; pointer-events: none; }
    .gated > *:not(.gate-overlay) { filter: blur(6px); opacity: 0.4; }
    .gate-overlay { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; z-index: 10; pointer-events: auto; }
    .gate-cta { text-align: center; background: #12121aee; border: 1px solid #2a2a36; border-radius: 12px; padding: 28px 36px; max-width: 400px; }
    .gate-cta h3 { font-size: 16px; color: #fff; margin-bottom: 6px; }
    .gate-cta p { font-size: 12px; color: #6b7280; margin-bottom: 14px; line-height: 1.5; }
    .gate-cta .upgrade-btn { display: inline-block; padding: 8px 24px; background: linear-gradient(135deg, #3b82f6, #8b5cf6); color: #fff; font-size: 13px; font-weight: 600; border: none; border-radius: 6px; cursor: pointer; text-decoration: none; transition: opacity 0.15s; }
    .gate-cta .upgrade-btn:hover { opacity: 0.85; }
    .gate-cta .gate-tier { font-size: 10px; color: #4b5563; margin-top: 8px; }

    .plan-badge { font-size: 9px; font-weight: 700; padding: 2px 8px; border-radius: 4px; text-transform: uppercase; letter-spacing: 0.5px; }
    .plan-badge.free { background: #37415118; color: #6b7280; }
    .plan-badge.basic { background: #3b82f618; color: #60a5fa; }
    .plan-badge.pro { background: linear-gradient(135deg, #8b5cf620, #ec489920); color: #c084fc; }

    /* ── Analytics panel ── */
    .analytics-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; padding: 20px 28px; }
    .analytics-card { background: #12121a; border: 1px solid #1e1e2a; border-radius: 10px; padding: 16px 18px; }
    .analytics-card.wide { grid-column: 1 / -1; }
    .analytics-title { font-size: 11px; font-weight: 700; color: #6b7280; text-transform: uppercase; letter-spacing: 0.6px; margin-bottom: 12px; }
    .analytics-chart { height: 220px; position: relative; }
    .analytics-card.wide .analytics-chart { height: 260px; }

    @media (max-width: 800px) { .analytics-grid { grid-template-columns: 1fr; } .analytics-card.wide { grid-column: 1; } }

    /* ── Simulator panel ── */
    .sim-controls { display: flex; flex-wrap: wrap; gap: 16px; padding: 20px 28px; background: #0e0e16; border-bottom: 1px solid #1a1a24; align-items: flex-end; }
    .sim-group { display: flex; flex-direction: column; gap: 4px; }
    .sim-group label { font-size: 10px; font-weight: 700; color: #4b5563; text-transform: uppercase; letter-spacing: 0.5px; }
    .sim-group input[type="range"] { width: 120px; accent-color: #3b82f6; }
    .sim-range-val { font-size: 11px; color: #e5e7eb; font-weight: 600; min-width: 28px; text-align: center; }
    .sim-group input[type="number"] { width: 70px; background: #14141e; border: 1px solid #1e1e2a; border-radius: 4px; padding: 4px 8px; font-size: 12px; color: #e5e7eb; font-family: inherit; }
    .sim-group input[type="number"]:focus { border-color: #3b82f6; outline: none; }
    .sim-chips { display: flex; gap: 4px; flex-wrap: wrap; }
    .sim-chip { background: #14141e; border: 1px solid #1e1e2a; border-radius: 4px; padding: 4px 10px; font-size: 11px; color: #6b7280; cursor: pointer; font-family: inherit; transition: all 0.15s; }
    .sim-chip:hover { border-color: #3b82f6; color: #93c5fd; }
    .sim-chip.active { background: #3b82f618; border-color: #3b82f6; color: #60a5fa; }
    .sim-run-btn { background: linear-gradient(135deg, #3b82f6, #8b5cf6); border: none; border-radius: 6px; padding: 8px 20px; font-size: 12px; font-weight: 700; color: #fff; cursor: pointer; font-family: inherit; transition: opacity 0.15s; white-space: nowrap; }
    .sim-run-btn:hover { opacity: 0.85; }
    .sim-run-btn:disabled { opacity: 0.4; cursor: not-allowed; }
    .sim-results { padding: 20px 28px; }
    .sim-kpi-strip { display: flex; gap: 0; background: #12121a; border: 1px solid #1e1e2a; border-radius: 8px; overflow: hidden; margin-bottom: 16px; }
    .sim-kpi { flex: 1; padding: 14px 16px; text-align: center; border-right: 1px solid #1a1a24; }
    .sim-kpi:last-child { border-right: none; }
    .sim-kpi-label { font-size: 10px; color: #4b5563; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px; }
    .sim-kpi-val { font-size: 18px; font-weight: 700; font-variant-numeric: tabular-nums; color: #e5e7eb; }
    .sim-kpi-val.green { color: #34d399; }
    .sim-kpi-val.red { color: #f87171; }
    .sim-empty { text-align: center; padding: 48px 20px; color: #374151; font-size: 13px; }

    /* ── Signal feed ── */
    .feed-controls { display: flex; gap: 6px; padding: 14px 28px; flex-wrap: wrap; border-bottom: 1px solid #1a1a24; background: #0e0e16; }
    .feed-list { padding: 0 28px 28px; }
    .feed-item { display: flex; gap: 14px; padding: 14px 0; border-bottom: 1px solid #141420; align-items: flex-start; }
    .feed-item:last-child { border-bottom: none; }
    .feed-time { font-size: 11px; color: #4b5563; min-width: 70px; padding-top: 2px; font-variant-numeric: tabular-nums; }
    .feed-side { width: 60px; font-size: 11px; font-weight: 700; text-align: center; padding: 3px 0; border-radius: 4px; flex-shrink: 0; }
    .feed-side.yes { background: #34d39918; color: #34d399; }
    .feed-side.no { background: #f8717118; color: #f87171; }
    .feed-body { flex: 1; min-width: 0; }
    .feed-question { font-size: 13px; color: #d1d5db; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .feed-meta { display: flex; gap: 12px; font-size: 11px; color: #4b5563; margin-top: 4px; }
    .feed-meta span em { font-style: normal; color: #9ca3af; font-weight: 500; }
    .feed-outcome { width: 52px; text-align: center; font-size: 10px; font-weight: 700; border-radius: 4px; padding: 3px 6px; flex-shrink: 0; }
    .feed-outcome.win { background: #34d39918; color: #34d399; }
    .feed-outcome.loss { background: #f8717118; color: #f87171; }
    .feed-outcome.void { background: #37415118; color: #6b7280; }
    .feed-outcome.pending { background: #fbbf2418; color: #fbbf24; }
    .share-btn { background: none; border: none; cursor: pointer; font-size: 13px; padding: 2px 6px; opacity: 0.35; transition: opacity 0.15s; flex-shrink: 0; }
    .share-btn:hover { opacity: 0.8; }
    .try-btn { background: #1a1a24; border: 1px solid #2a2a36; border-radius: 6px; padding: 3px 10px; font-size: 10px; color: #93c5fd; cursor: pointer; font-family: inherit; font-weight: 600; transition: all 0.15s; }
    .try-btn:hover { border-color: #3b82f6; background: #3b82f618; }
    .feed-more { text-align: center; padding: 16px; }
    .feed-more-btn { background: #14141e; border: 1px solid #1e1e2a; border-radius: 6px; padding: 8px 24px; font-size: 12px; color: #6b7280; cursor: pointer; font-family: inherit; transition: all 0.15s; }
    .feed-more-btn:hover { border-color: #3b82f6; color: #93c5fd; }

    /* ── Market detail modal ── */
    .mkt-detail-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 16px; }
    .mkt-detail-card { background: #0e0e16; border: 1px solid #1a1a24; border-radius: 8px; padding: 12px; text-align: center; }
    .mkt-detail-label { font-size: 10px; color: #4b5563; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px; }
    .mkt-detail-val { font-size: 20px; font-weight: 700; font-variant-numeric: tabular-nums; }
    .mkt-detail-val.green { color: #34d399; }
    .mkt-detail-val.red { color: #f87171; }
    .mkt-detail-val.amber { color: #fbbf24; }
    .mkt-mini-chart { height: 160px; margin-top: 16px; }

    /* ── Tooltips ── */
    .tip { position: relative; display: inline-flex; align-items: center; cursor: help; }
    .tip-icon { display: inline-flex; align-items: center; justify-content: center; width: 14px; height: 14px; border-radius: 50%; background: #1e1e2a; color: #4b5563; font-size: 9px; font-weight: 700; margin-left: 4px; flex-shrink: 0; }
    .tip-icon:hover { background: #3b82f630; color: #60a5fa; }
    .tip-text { display: none; position: absolute; bottom: calc(100% + 6px); left: 50%; transform: translateX(-50%); background: #1a1a24; border: 1px solid #2a2a36; border-radius: 6px; padding: 8px 12px; font-size: 11px; color: #c8c8d0; line-height: 1.5; white-space: normal; width: 220px; z-index: 200; pointer-events: none; box-shadow: 0 4px 12px #00000060; }
    .tip:hover .tip-text { display: block; }

    /* ── Welcome modal ── */
    .welcome-step { display: none; text-align: center; padding: 20px; }
    .welcome-step.active { display: block; }
    .welcome-step h3 { font-size: 18px; color: #fff; margin-bottom: 8px; }
    .welcome-step p { font-size: 13px; color: #9ca3af; line-height: 1.6; margin-bottom: 16px; }
    .welcome-dots { display: flex; gap: 6px; justify-content: center; margin-bottom: 16px; }
    .welcome-dot { width: 8px; height: 8px; border-radius: 50%; background: #27272f; }
    .welcome-dot.active { background: #3b82f6; }
    .welcome-nav { display: flex; gap: 10px; justify-content: center; }
    .welcome-nav button { padding: 8px 20px; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer; font-family: inherit; border: none; transition: opacity 0.15s; }
    .welcome-skip { background: #14141e; color: #6b7280; border: 1px solid #1e1e2a !important; }
    .welcome-skip:hover { color: #9ca3af; }
    .welcome-next { background: linear-gradient(135deg, #3b82f6, #8b5cf6); color: #fff; }
    .welcome-next:hover { opacity: 0.85; }

    /* ── Single-market mode (legacy fallback) ── */
    #singleMode { display: none; }
    #singleMode.visible { display: block; }
    #singleMode .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; padding: 16px 28px; }
    @media (max-width: 900px) { #singleMode .grid { grid-template-columns: 1fr; } }
    .card { background: #12121a; border: 1px solid #1e1e2a; border-radius: 8px; padding: 16px; }
    .card-title { font-size: 10px; text-transform: uppercase; letter-spacing: 0.8px; color: #4b5563; margin-bottom: 10px; font-weight: 600; }
    .signal-box { text-align: center; padding: 20px; }
    .signal-text { font-size: 28px; font-weight: 700; margin-bottom: 6px; }
    .signal-text.buy-up { color: #34d399; }
    .signal-text.buy-down { color: #f87171; }
    .signal-text.no-trade-text { color: #374151; }
    .rec-detail { font-size: 12px; color: #6b7280; }
    .kv-row { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #141420; }
    .kv-row:last-child { border-bottom: none; }
    .kv-label { color: #4b5563; font-size: 12px; }
    .kv-value { font-size: 12px; font-weight: 500; font-variant-numeric: tabular-nums; }
    .green { color: #34d399; }
    .red { color: #f87171; }
    .prob-bar { display: flex; height: 24px; border-radius: 4px; overflow: hidden; margin-top: 8px; }
    .prob-up { background: #34d39920; color: #34d399; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 600; }
    .prob-down { background: #f8717120; color: #f87171; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 600; }
    .chart-container { height: 150px; position: relative; }
    .wide { grid-column: 1 / -1; }

    @media (max-width: 700px) {
      .summary-strip { flex-wrap: wrap; }
      .signal-grid { grid-template-columns: 1fr; }
      .table-wrap { overflow-x: auto; }
    }

    /* ── Settings tab ── */
    .settings-wrap { padding: 20px 28px; max-width: 720px; }
    .settings-section { background: #12121a; border: 1px solid #1e1e2a; border-radius: 10px; padding: 18px 20px; margin-bottom: 14px; }
    .settings-section-title { font-size: 12px; font-weight: 700; color: #e5e7eb; text-transform: uppercase; letter-spacing: 0.6px; margin-bottom: 12px; }
    .settings-row { display: flex; align-items: center; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #141420; }
    .settings-row:last-child { border-bottom: none; }
    .settings-label { font-size: 12px; color: #9ca3af; }
    .settings-val { font-size: 12px; font-weight: 600; color: #e5e7eb; font-variant-numeric: tabular-nums; }
    .settings-btn { background: #1a1a24; border: 1px solid #2a2a36; border-radius: 6px; padding: 5px 14px; font-size: 11px; color: #93c5fd; cursor: pointer; font-family: inherit; font-weight: 600; transition: all 0.15s; }
    .settings-btn:hover { border-color: #3b82f6; background: #3b82f618; }
    .settings-btn.danger { color: #f87171; }
    .settings-btn.danger:hover { border-color: #f87171; background: #f8717118; }
    .settings-input { background: #0e0e16; border: 1px solid #1e1e2a; border-radius: 6px; padding: 6px 10px; font-size: 12px; color: #e5e7eb; font-family: inherit; width: 100%; }
    .settings-input:focus { outline: none; border-color: #3b82f6; }
    .settings-toggle { position: relative; width: 36px; height: 20px; background: #2a2a36; border-radius: 10px; cursor: pointer; transition: background 0.2s; flex-shrink: 0; }
    .settings-toggle.on { background: #34d399; }
    .settings-toggle::after { content: ""; position: absolute; top: 2px; left: 2px; width: 16px; height: 16px; border-radius: 50%; background: #fff; transition: transform 0.2s; }
    .settings-toggle.on::after { transform: translateX(16px); }
    .key-item { display: flex; align-items: center; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #141420; gap: 10px; }
    .key-item:last-child { border-bottom: none; }
    .key-prefix { font-size: 12px; font-family: monospace; color: #a5b4fc; }
    .key-meta { font-size: 10px; color: #4b5563; }
    .webhook-item { display: flex; align-items: center; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #141420; gap: 10px; }
    .webhook-item:last-child { border-bottom: none; }
    .webhook-url { font-size: 11px; font-family: monospace; color: #9ca3af; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 360px; }
    .webhook-stats { font-size: 10px; color: #4b5563; white-space: nowrap; }
    .key-reveal { background: #34d39920; border: 1px solid #34d39940; border-radius: 6px; padding: 10px 14px; margin: 10px 0; font-family: monospace; font-size: 12px; color: #34d399; word-break: break-all; }
    .settings-form { display: flex; gap: 8px; margin-top: 10px; }
    .settings-form .settings-input { flex: 1; }
    .cat-checks { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 6px; }
    .cat-check { display: flex; align-items: center; gap: 4px; font-size: 11px; color: #9ca3af; cursor: pointer; }
    .cat-check input { accent-color: #3b82f6; }

    /* ── Toast notifications ── */
    .toast-container { position: fixed; bottom: 20px; right: 20px; z-index: 10000; display: flex; flex-direction: column-reverse; gap: 8px; pointer-events: none; }
    .toast { pointer-events: auto; padding: 10px 16px; border-radius: 8px; font-size: 12px; font-weight: 500; color: #e5e7eb; background: #1a1a24; border: 1px solid #2a2a36; box-shadow: 0 4px 12px rgba(0,0,0,0.4); max-width: 340px; animation: toast-in 0.3s ease; }
    .toast.error { border-color: #f8717140; color: #fca5a5; }
    .toast.success { border-color: #34d39940; color: #34d399; }
    .toast.info { border-color: #3b82f640; color: #93c5fd; }
    @keyframes toast-in { from { opacity:0; transform: translateY(12px); } to { opacity:1; transform: translateY(0); } }

    /* ── WS reconnect overlay ── */
    .reconnect-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(11,11,17,0.85); display: flex; align-items: center; justify-content: center; z-index: 9999; }
    .reconnect-overlay .msg { text-align: center; }
    .reconnect-overlay .msg h3 { color: #fbbf24; font-size: 16px; margin-bottom: 6px; }
    .reconnect-overlay .msg p { color: #6b7280; font-size: 12px; }
    .reconnect-spinner { width: 24px; height: 24px; border: 3px solid #2a2a36; border-top-color: #fbbf24; border-radius: 50%; animation: spin 0.8s linear infinite; margin: 12px auto 0; }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* ── Mobile responsive ── */
    @media (max-width: 768px) {
      .header { flex-direction: column; gap: 10px; padding: 10px 16px; }
      .header-right { flex-wrap: wrap; gap: 6px; justify-content: center; }
      .tab-btn { font-size: 10px; padding: 4px 8px; }
      .header-link { font-size: 10px; }
      .plan-badge { font-size: 9px; }
      .notify-btn { font-size: 10px; padding: 3px 8px; }
      .summary-strip { padding: 0 16px; flex-wrap: wrap; }
      .summary-item { padding: 6px 12px 6px 0; font-size: 11px; }
      .signals-panel { padding: 14px 16px; }
      .signal-grid { grid-template-columns: 1fr; }
      .filter-bar { padding: 6px 16px; }
      .table-section { padding: 14px 16px; }
      .table-wrap { overflow-x: auto; -webkit-overflow-scrolling: touch; }
      .table-wrap table { min-width: 700px; }
      .analytics-grid { grid-template-columns: 1fr; padding: 14px 16px; }
      .analytics-card.wide { grid-column: 1; }
      .sim-controls { padding: 14px 16px; }
      .feed-controls { padding: 10px 16px; }
      .feed-list { padding: 0 16px; }
      .modal { margin: 0; max-width: 100vw !important; width: 100vw; min-height: 100vh; border-radius: 0; }
      .settings-wrap { padding: 14px 16px; }
      .mkt-detail-grid { grid-template-columns: 1fr 1fr; }
    }
    @media (max-width: 480px) {
      .header-right { gap: 4px; }
      .tab-btn { font-size: 9px; padding: 3px 6px; }
      .sig-metrics { grid-template-columns: 1fr 1fr; }
      .sig-card { padding: 12px 14px; }
      .kpi-strip { flex-direction: column; }
      .summary-item { font-size: 10px; }
    }
  </style>
</head>
<body>

<!-- ── Header ── -->
<div class="header">
  <div class="header-left">
    <h1>PolySignal</h1>
    <div class="conn-badge">
      <div class="conn-dot" id="statusDot"></div>
      <span id="statusText">Connecting</span>
    </div>
    <span class="freshness-badge" id="freshnessBadge" title="Data freshness"></span>
  </div>
  <div class="header-right">
    <button class="tab-btn active" id="tabDashboard" onclick="switchTab('dashboard')">Dashboard</button>
    <button class="tab-btn" id="tabAnalytics" onclick="switchTab('analytics')">Analytics</button>
    <button class="tab-btn" id="tabPortfolio" onclick="switchTab('portfolio')">Portfolio</button>
    <button class="tab-btn" id="tabFeed" onclick="switchTab('feed')">Feed</button>
    <button class="tab-btn" id="tabSimulator" onclick="switchTab('simulator')">Simulator</button>
    <button class="tab-btn" id="tabSettings" onclick="switchTab('settings')">Settings</button>
    <span class="plan-badge free" id="planBadge">FREE</span>
    <button class="notify-btn" id="notifyBtn" onclick="toggleNotifications()" title="Toggle alerts">Alerts: Off</button>
    <a href="/stats.html" class="header-link">Performance</a>
    <a href="/leaderboard.html" class="header-link">Leaderboard</a>
    <a href="/terms.html" class="header-link">Terms</a>
    <a href="/privacy.html" class="header-link">Privacy</a>
  </div>
</div>

<!-- ═══════ SCANNER MODE ═══════ -->
<div id="scannerMode">

  <!-- Summary strip -->
  <div class="summary-strip">
    <div class="summary-item">Tracking <span class="summary-val" id="statTracked">0</span> markets</div>
    <div class="summary-item">Active signals <span class="summary-val highlight" id="statSignals">0</span></div>
    <div class="summary-item">Last scan <span class="summary-val" id="statUpdated">--:--:--</span></div>
  </div>

  <!-- Signals -->
  <div class="signals-panel">
    <div class="section-header">
      <span class="section-title">Actionable Signals</span>
      <span class="signal-count-badge zero" id="sigCountBadge">0</span>
    </div>

    <div class="signal-explainer">
      <strong>How to read signals:</strong>
      A signal fires when our model believes a Polymarket outcome is mispriced.
      <strong>BUY YES</strong> = the model thinks YES will happen but the market price is too low — buy YES shares.
      <strong>BUY NO</strong> = the model thinks NO will happen but the market price is too low — buy NO shares.
      <strong>Edge</strong> = how much the model's probability exceeds the market price (bigger = stronger conviction).
      <strong>Strength:</strong> STRONG (high edge + multiple indicators agree) / GOOD (solid edge, some confirmation).
    </div>

    <div id="signalCards">
      <div class="no-signals-box" id="noSignals">
        <div class="icon">~</div>
        <p><strong>Scanning markets...</strong><br>Signals appear when the model detects a mispriced outcome.</p>
      </div>
    </div>
  </div>

  <!-- Category filter -->
  <div class="filter-bar" id="filterBar">
    <button class="fbtn active" data-cat="all">All</button>
  </div>

  <!-- Markets table -->
  <div class="table-section">
    <div class="section-header">
      <span class="section-title">All Tracked Markets</span>
    </div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th style="min-width:220px">Market</th>
            <th>Category</th>
            <th>Signal</th>
            <th>Model&nbsp;Prob</th>
            <th>Market&nbsp;Price</th>
            <th><span class="tip">Edge<span class="tip-icon">?</span><span class="tip-text">How much the model's probability exceeds the market price. Bigger = stronger mispricing.</span></span></th>
            <th>RSI</th>
            <th>Vol</th>
            <th><span class="tip">TF<span class="tip-icon">?</span><span class="tip-text">Multi-timeframe confluence: how many timeframes (1m/5m/15m) agree on direction. 3/3 = strong.</span></span></th>
            <th><span class="tip">Conf<span class="tip-icon">?</span><span class="tip-text">Confidence score (0-100) combining 9 factors: edge, indicators, confluence, flow, correlation, volatility, time, regime, combo learning.</span></span></th>
            <th><span class="tip">Flow<span class="tip-icon">?</span><span class="tip-text">Order flow pressure from the orderbook. Shows whether buy/sell pressure supports or conflicts with the signal.</span></span></th>
            <th>Time Left</th>
            <th>Liquidity</th>
          </tr>
        </thead>
        <tbody id="marketsBody"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- ═══════ ANALYTICS MODE ═══════ -->
<div id="analyticsMode" style="display:none">

  <!-- Analytics controls -->
  <div style="display:flex;justify-content:flex-end;padding:12px 28px 0;gap:8px">
    <button class="fbtn" id="exportCsvBtn" onclick="exportCsv()" title="Export settled signals as CSV (Pro)">Export CSV</button>
  </div>

  <!-- KPI strip -->
  <div class="summary-strip">
    <div class="summary-item">Win Rate <span class="summary-val highlight" id="kpiWinRate">-</span></div>
    <div class="summary-item">Total P&L <span class="summary-val" id="kpiTotalPnl">-</span></div>
    <div class="summary-item">Settled <span class="summary-val" id="kpiSettled">-</span></div>
    <div class="summary-item">Max Drawdown <span class="summary-val" id="kpiDrawdown">-</span></div>
    <div class="summary-item">Streak <span class="summary-val" id="kpiStreak">-</span></div>
    <div class="summary-item">Avg Confidence <span class="summary-val" id="kpiAvgConf">-</span></div>
  </div>

  <!-- Charts grid -->
  <div class="analytics-grid">
    <div class="analytics-card wide">
      <div class="analytics-title">Equity Curve (Cumulative P&L)</div>
      <div class="analytics-chart"><canvas id="equityChart"></canvas></div>
    </div>
    <div class="analytics-card">
      <div class="analytics-title">Daily Win Rate</div>
      <div class="analytics-chart"><canvas id="winRateChart"></canvas></div>
    </div>
    <div class="analytics-card">
      <div class="analytics-title">Performance by Category</div>
      <div class="analytics-chart"><canvas id="categoryChart"></canvas></div>
    </div>
    <div class="analytics-card">
      <div class="analytics-title">Confidence Calibration</div>
      <div class="analytics-chart"><canvas id="calibrationChart"></canvas></div>
    </div>
    <div class="analytics-card">
      <div class="analytics-title">Daily Signals Volume</div>
      <div class="analytics-chart"><canvas id="volumeChart"></canvas></div>
    </div>
  </div>

  <!-- Recent settled signals -->
  <div class="table-section">
    <div class="section-header">
      <span class="section-title">Recent Settled Signals</span>
    </div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th style="min-width:180px">Market</th>
            <th>Side</th>
            <th>Outcome</th>
            <th>Edge</th>
            <th>Conf</th>
            <th>Kelly</th>
            <th>P&L</th>
            <th>Time</th>
          </tr>
        </thead>
        <tbody id="settledBody"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- ═══════ PORTFOLIO MODE ═══════ -->
<div id="portfolioMode" style="display:none">

  <!-- Portfolio KPIs -->
  <div class="summary-strip">
    <div class="summary-item">Open Positions <span class="summary-val highlight" id="pfOpen">-</span></div>
    <div class="summary-item">Total Exposure <span class="summary-val" id="pfExposure">-</span></div>
    <div class="summary-item">Unrealized P&L <span class="summary-val" id="pfUnrealized">-</span></div>
    <div class="summary-item">Realized P&L <span class="summary-val" id="pfRealized">-</span></div>
    <div class="summary-item">Win Rate <span class="summary-val" id="pfWinRate">-</span></div>
    <div class="summary-item">Best Trade <span class="summary-val" id="pfBest">-</span></div>
  </div>

  <!-- Open positions -->
  <div class="table-section" style="padding-top:20px">
    <div class="section-header">
      <span class="section-title">Open Positions</span>
    </div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th style="min-width:200px">Market</th>
            <th>Side</th>
            <th>Entry</th>
            <th>Current</th>
            <th>Bet %</th>
            <th>Conf</th>
            <th>Unrealized</th>
            <th>Win Prob</th>
            <th>Risk</th>
            <th>Opened</th>
          </tr>
        </thead>
        <tbody id="openPositionsBody"></tbody>
      </table>
    </div>
  </div>

  <!-- Recent closed -->
  <div class="table-section">
    <div class="section-header">
      <span class="section-title">Recent Trades</span>
    </div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th style="min-width:200px">Market</th>
            <th>Side</th>
            <th>Entry</th>
            <th>Exit</th>
            <th>Bet %</th>
            <th>P&L</th>
            <th>Status</th>
            <th>Closed</th>
          </tr>
        </thead>
        <tbody id="recentTradesBody"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- ═══════ FEED MODE ═══════ -->
<div id="feedMode" style="display:none">
  <div class="feed-controls">
    <button class="fbtn active" data-feed-filter="all" onclick="setFeedFilter('all',this)">All</button>
    <button class="fbtn" data-feed-filter="pending" onclick="setFeedFilter('pending',this)">Pending</button>
    <button class="fbtn" data-feed-filter="WIN" onclick="setFeedFilter('WIN',this)">Wins</button>
    <button class="fbtn" data-feed-filter="LOSS" onclick="setFeedFilter('LOSS',this)">Losses</button>
  </div>
  <div class="feed-list" id="feedList">
    <div class="sim-empty">Loading signal feed...</div>
  </div>
</div>

<!-- ═══════ SIMULATOR MODE ═══════ -->
<div id="simulatorMode" style="display:none">

  <!-- Filter controls -->
  <div class="sim-controls">
    <div class="sim-group">
      <label>Min Confidence</label>
      <div style="display:flex;align-items:center;gap:6px">
        <input type="range" id="simMinConf" min="0" max="100" value="0" oninput="$('simMinConfVal').textContent=this.value">
        <span class="sim-range-val" id="simMinConfVal">0</span>
      </div>
    </div>
    <div class="sim-group">
      <label>Min Edge %</label>
      <input type="number" id="simMinEdge" value="0" step="0.5" min="0" max="50" placeholder="0">
    </div>
    <div class="sim-group">
      <label>Categories</label>
      <div class="sim-chips" id="simCatChips"></div>
    </div>
    <div class="sim-group">
      <label>Strength</label>
      <div class="sim-chips">
        <button class="sim-chip active" data-str="all" onclick="toggleSimStr(this)">All</button>
        <button class="sim-chip" data-str="STRONG" onclick="toggleSimStr(this)">Strong</button>
        <button class="sim-chip" data-str="GOOD" onclick="toggleSimStr(this)">Good</button>
      </div>
    </div>
    <div class="sim-group">
      <label>Side</label>
      <div class="sim-chips">
        <button class="sim-chip active" data-side="all" onclick="toggleSimSide(this)">Both</button>
        <button class="sim-chip" data-side="UP" onclick="toggleSimSide(this)">YES</button>
        <button class="sim-chip" data-side="DOWN" onclick="toggleSimSide(this)">NO</button>
      </div>
    </div>
    <button class="sim-run-btn" id="simRunBtn" onclick="runSimulation()">Run Simulation</button>
    <button class="sim-run-btn" style="background:#1a1a24;border-color:#2a2a36;color:#93c5fd;margin-left:8px" onclick="saveCurrentStrategy()">Save Strategy</button>
  </div>

  <!-- Saved Strategies -->
  <div style="margin-top:12px">
    <div style="font-size:11px;font-weight:700;color:#6b7280;margin-bottom:6px">SAVED STRATEGIES</div>
    <div id="strategyList"><div style="color:#4b5563;font-size:11px">No saved strategies</div></div>
  </div>

  <!-- Results -->
  <div class="sim-results" id="simResults">
    <div class="sim-empty">Configure filters above and click <strong>Run Simulation</strong> to backtest your strategy against historical signals.</div>
  </div>
</div>

<!-- ═══════ SINGLE-MARKET MODE (legacy) ═══════ -->
<div id="singleMode">
  <div class="grid">
    <div class="card signal-box">
      <div class="card-title">Signal</div>
      <div class="signal-text no-trade-text" id="signalText">-</div>
      <div class="rec-detail" id="recDetail">-</div>
    </div>
    <div class="card">
      <div class="card-title">Model Probability</div>
      <div class="prob-bar">
        <div class="prob-up" id="probUp" style="width:50%">YES 50%</div>
        <div class="prob-down" id="probDown" style="width:50%">NO 50%</div>
      </div>
      <div style="margin-top:10px">
        <div class="kv-row"><span class="kv-label">Edge YES</span><span class="kv-value" id="edgeUp">-</span></div>
        <div class="kv-row"><span class="kv-label">Edge NO</span><span class="kv-value" id="edgeDown">-</span></div>
        <div class="kv-row"><span class="kv-label">Regime</span><span class="kv-value" id="regime">-</span></div>
      </div>
    </div>
    <div class="card">
      <div class="card-title">Prices</div>
      <div class="kv-row"><span class="kv-label">BTC (Binance)</span><span class="kv-value" id="btcPrice">-</span></div>
      <div class="kv-row"><span class="kv-label">Current (Chainlink)</span><span class="kv-value" id="currentPrice">-</span></div>
      <div class="kv-row"><span class="kv-label">Price to Beat</span><span class="kv-value" id="priceToBeat">-</span></div>
      <div class="kv-row"><span class="kv-label">Delta 1m / 3m</span><span class="kv-value" id="deltas">-</span></div>
    </div>
    <div class="card">
      <div class="card-title">Indicators</div>
      <div class="kv-row"><span class="kv-label">VWAP</span><span class="kv-value" id="vwap">-</span></div>
      <div class="kv-row"><span class="kv-label">RSI</span><span class="kv-value" id="rsi">-</span></div>
      <div class="kv-row"><span class="kv-label">MACD</span><span class="kv-value" id="macd">-</span></div>
      <div class="kv-row"><span class="kv-label">Heiken Ashi</span><span class="kv-value" id="heiken">-</span></div>
      <div class="kv-row"><span class="kv-label">Time Left</span><span class="kv-value" id="timeLeft">-</span></div>
    </div>
    <div class="card">
      <div class="card-title">Polymarket</div>
      <div class="kv-row"><span class="kv-label">Market</span><span class="kv-value" id="marketSlug">-</span></div>
      <div class="kv-row"><span class="kv-label">YES Price</span><span class="kv-value green" id="mktUp">-</span></div>
      <div class="kv-row"><span class="kv-label">NO Price</span><span class="kv-value red" id="mktDown">-</span></div>
      <div class="kv-row"><span class="kv-label">Liquidity</span><span class="kv-value" id="liquidity">-</span></div>
    </div>
    <div class="card wide">
      <div class="card-title">BTC Price (last 60 ticks)</div>
      <div class="chart-container"><canvas id="priceChart"></canvas></div>
    </div>
    <div class="card">
      <div class="card-title">RSI (last 60 ticks)</div>
      <div class="chart-container"><canvas id="rsiChart"></canvas></div>
    </div>
    <div class="card">
      <div class="card-title">Model Probability (last 60 ticks)</div>
      <div class="chart-container"><canvas id="probChart"></canvas></div>
    </div>
  </div>
</div>

<!-- Signal detail modal -->
<div class="modal-overlay" id="signalModal" onclick="if(event.target===this)closeModal()">
  <div class="modal" id="signalModalContent"></div>
</div>

<!-- Market detail modal -->
<div class="modal-overlay" id="marketModal" onclick="if(event.target===this)closeMarketModal()">
  <div class="modal" id="marketModalContent" style="max-width:600px"></div>
</div>

<!-- Upgrade modal -->
<div class="modal-overlay" id="upgradeModal" onclick="if(event.target===this)closeUpgradeModal()">
  <div class="modal" style="max-width:440px;text-align:center">
    <button class="modal-close" onclick="closeUpgradeModal()">&times;</button>
    <h3 style="margin-bottom:12px">Upgrade Your Plan</h3>
    <p style="color:#6b7280;font-size:13px;margin-bottom:20px">Unlock more features with a paid subscription.</p>
    <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap">
      <div style="flex:1;min-width:160px;background:#14141e;border:1px solid #1e1e2a;border-radius:10px;padding:16px">
        <div style="font-size:12px;font-weight:700;color:#60a5fa;margin-bottom:6px">BASIC</div>
        <div style="font-size:24px;font-weight:700;color:#fff">$19<span style="font-size:12px;color:#4b5563">/mo</span></div>
        <ul style="list-style:none;text-align:left;font-size:11px;color:#9ca3af;margin-top:10px;line-height:1.8">
          <li>All signals + detail modal</li>
          <li>Portfolio tracker</li>
          <li>Desktop notifications</li>
          <li>Telegram + Discord bots</li>
        </ul>
        <a href="/api/auth/login" class="upgrade-btn" style="display:block;margin-top:12px;text-align:center">Get Basic</a>
      </div>
      <div style="flex:1;min-width:160px;background:#14141e;border:1px solid #8b5cf640;border-radius:10px;padding:16px">
        <div style="font-size:12px;font-weight:700;color:#c084fc;margin-bottom:6px">PRO</div>
        <div style="font-size:24px;font-weight:700;color:#fff">$49<span style="font-size:12px;color:#4b5563">/mo</span></div>
        <ul style="list-style:none;text-align:left;font-size:11px;color:#9ca3af;margin-top:10px;line-height:1.8">
          <li>Everything in Basic</li>
          <li>Analytics dashboard</li>
          <li>Strategy simulator</li>
          <li>CSV signal export</li>
        </ul>
        <a href="/api/auth/login" class="upgrade-btn" style="display:block;margin-top:12px;text-align:center;background:linear-gradient(135deg,#8b5cf6,#ec4899)">Get Pro</a>
      </div>
    </div>
  </div>
</div>

<!-- ═══════ SETTINGS MODE ═══════ -->
<div id="settingsMode" style="display:none">
  <div class="settings-wrap">

    <!-- Account -->
    <div class="settings-section">
      <div class="settings-section-title">Account</div>
      <div class="settings-row"><span class="settings-label">Email</span><span class="settings-val" id="setEmail">Not logged in</span></div>
      <div class="settings-row"><span class="settings-label">Plan</span><span class="settings-val" id="setPlan">Free</span></div>
      <div class="settings-row"><span class="settings-label">Login</span><span class="settings-val"><button class="settings-btn" id="setLoginBtn" onclick="settingsLogin()">Send Magic Link</button></span></div>
    </div>

    <!-- API Keys -->
    <div class="settings-section">
      <div class="settings-section-title">API Keys</div>
      <div id="apiKeysList"><div style="color:#4b5563;font-size:12px">Login required</div></div>
      <div id="apiKeyReveal" style="display:none"></div>
      <div style="margin-top:10px">
        <button class="settings-btn" id="createKeyBtn" onclick="createApiKey()">+ Create Key</button>
      </div>
    </div>

    <!-- Webhooks -->
    <div class="settings-section">
      <div class="settings-section-title">Webhooks</div>
      <div id="webhooksList"><div style="color:#4b5563;font-size:12px">Login required</div></div>
      <div class="settings-form" id="webhookForm">
        <input type="url" class="settings-input" id="webhookUrlInput" placeholder="https://your-endpoint.com/webhook">
        <button class="settings-btn" onclick="addWebhook()">Add</button>
      </div>
    </div>

    <!-- Email Alerts -->
    <div class="settings-section">
      <div class="settings-section-title">Email Alerts</div>
      <div class="settings-row">
        <span class="settings-label">Alerts enabled</span>
        <div class="settings-toggle" id="emailAlertToggle" onclick="toggleEmailAlerts()"></div>
      </div>
      <div class="settings-row">
        <span class="settings-label">Min confidence</span>
        <div style="display:flex;align-items:center;gap:6px">
          <input type="range" id="emailMinConf" min="0" max="100" value="60" oninput="$('emailMinConfVal').textContent=this.value" style="width:120px">
          <span class="settings-val" id="emailMinConfVal">60</span>
        </div>
      </div>
      <div class="settings-row" style="flex-direction:column;align-items:flex-start;gap:6px">
        <span class="settings-label">Categories</span>
        <div class="cat-checks" id="emailCatChecks"></div>
      </div>
      <div class="settings-row">
        <span class="settings-label">Max alerts/hour</span>
        <div style="display:flex;align-items:center;gap:6px">
          <input type="range" id="emailMaxPerHour" min="1" max="50" value="20" oninput="$('emailMaxPerHourVal').textContent=this.value" style="width:120px">
          <span class="settings-val" id="emailMaxPerHourVal">20</span>
        </div>
      </div>
      <div class="settings-row">
        <span class="settings-label">Throttle status</span>
        <span class="settings-val" id="throttleStatus" style="color:#6b7280">-</span>
      </div>
      <div style="margin-top:10px"><button class="settings-btn" onclick="saveEmailPrefs()">Save Preferences</button></div>
    </div>

    <!-- Notification Settings -->
    <div class="settings-section">
      <div class="settings-section-title">Browser Notifications</div>
      <div class="settings-row">
        <span class="settings-label">Sound</span>
        <div class="settings-toggle" id="soundToggle" onclick="toggleSound()"></div>
      </div>
      <div class="settings-row">
        <span class="settings-label">Volume</span>
        <input type="range" id="soundVolume" min="0" max="100" value="50" oninput="saveSoundPrefs()" style="width:120px">
      </div>
      <div class="settings-row">
        <span class="settings-label">Test</span>
        <button class="settings-btn" onclick="testNotification()">Send Test</button>
      </div>
    </div>

  </div>
</div>

<!-- Toast container -->
<div class="toast-container" id="toastContainer"></div>

<!-- Reconnect overlay -->
<div class="reconnect-overlay" id="reconnectOverlay" style="display:none">
  <div class="msg">
    <h3>Connection Lost</h3>
    <p>Reconnecting to live data...</p>
    <div class="reconnect-spinner"></div>
  </div>
</div>

<!-- Welcome modal -->
<div class="modal-overlay" id="welcomeModal" onclick="if(event.target===this)closeWelcome()">
  <div class="modal" style="max-width:440px;padding:28px">
    <button class="modal-close" onclick="closeWelcome()">&times;</button>
    <div class="welcome-step active" data-step="0">
      <h3>Welcome to PolySignal</h3>
      <p>We scan 50+ Polymarket prediction markets in real-time, using AI-driven models to find mispriced outcomes you can trade.</p>
      <div style="font-size:32px;margin:12px 0">~</div>
    </div>
    <div class="welcome-step" data-step="1">
      <h3>How Signals Work</h3>
      <p><strong style="color:#34d399">BUY YES</strong> means the model thinks YES will happen but the market price is too low.<br><br>
      <strong style="color:#f87171">BUY NO</strong> means the opposite. <strong>Edge</strong> shows how much the model disagrees with the market. Bigger edge = stronger conviction.</p>
    </div>
    <div class="welcome-step" data-step="2">
      <h3>Confidence & Kelly</h3>
      <p><strong>Confidence (0-100)</strong> combines 9 factors: edge size, indicator agreement, multi-timeframe confluence, order flow, and more.<br><br>
      <strong>Kelly %</strong> is the mathematically optimal bet size based on your edge and win probability.</p>
    </div>
    <div class="welcome-step" data-step="3">
      <h3>Get More With Pro</h3>
      <p>Free users see 3 signals and 10 markets. Upgrade to unlock full analytics, portfolio tracking, strategy simulator, and CSV exports.</p>
      <div style="margin-top:8px">
        <button class="welcome-next" onclick="closeWelcome();showUpgradeModal()">View Plans</button>
      </div>
    </div>
    <div class="welcome-dots">
      <div class="welcome-dot active" data-dot="0"></div>
      <div class="welcome-dot" data-dot="1"></div>
      <div class="welcome-dot" data-dot="2"></div>
      <div class="welcome-dot" data-dot="3"></div>
    </div>
    <div class="welcome-nav">
      <button class="welcome-skip" onclick="closeWelcome()">Skip</button>
      <button class="welcome-next" id="welcomeNextBtn" onclick="nextWelcomeStep()">Next</button>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
<script src="app.js"></script>
<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("/sw.js").catch(() => {});
}
</script>
</body>
</html>
