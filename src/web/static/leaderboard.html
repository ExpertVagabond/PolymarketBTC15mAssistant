<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PolySignal Leaderboard</title>
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif; background: #0b0b11; color: #c8c8d0; min-height: 100vh; line-height: 1.5; }

    .header { padding: 14px 28px; background: #101018; border-bottom: 1px solid #1e1e2a; display: flex; align-items: center; justify-content: space-between; }
    .header-left { display: flex; align-items: center; gap: 14px; }
    .header-left h1 { font-size: 17px; color: #fff; font-weight: 700; letter-spacing: -0.3px; }
    .header-left .badge { font-size: 10px; font-weight: 700; padding: 2px 10px; border-radius: 20px; background: #a78bfa20; color: #a78bfa; }
    .header-right { display: flex; align-items: center; gap: 14px; }
    .header-link { color: #6b7280; text-decoration: none; font-size: 12px; font-weight: 500; }
    .header-link:hover { color: #a5b4fc; }

    .hero { text-align: center; padding: 40px 28px 20px; }
    .hero h2 { font-size: 22px; color: #fff; font-weight: 700; margin-bottom: 6px; }
    .hero p { font-size: 13px; color: #6b7280; max-width: 500px; margin: 0 auto; }

    .kpi-strip { display: flex; justify-content: center; gap: 0; padding: 0 28px 24px; flex-wrap: wrap; }
    .kpi-item { padding: 14px 28px; text-align: center; border-right: 1px solid #1a1a24; }
    .kpi-item:last-child { border-right: none; }
    .kpi-label { font-size: 10px; text-transform: uppercase; letter-spacing: 0.6px; color: #4b5563; margin-bottom: 4px; }
    .kpi-value { font-size: 26px; font-weight: 700; font-variant-numeric: tabular-nums; }
    .kpi-value.green { color: #34d399; }
    .kpi-value.purple { color: #a78bfa; }
    .kpi-value.amber { color: #fbbf24; }
    .kpi-value.blue { color: #60a5fa; }
    .kpi-sub { font-size: 10px; color: #4b5563; margin-top: 2px; }

    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; padding: 0 28px 28px; }
    .card { background: #12121a; border: 1px solid #1e1e2a; border-radius: 10px; padding: 16px 18px; }
    .card.wide { grid-column: 1 / -1; }
    .card-title { font-size: 11px; font-weight: 700; color: #6b7280; text-transform: uppercase; letter-spacing: 0.6px; margin-bottom: 12px; }

    /* Rank rows */
    .rank-row { display: flex; align-items: center; gap: 12px; padding: 10px 0; border-bottom: 1px solid #141420; }
    .rank-row:last-child { border-bottom: none; }
    .rank-pos { width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; border-radius: 6px; font-size: 12px; font-weight: 700; background: #1a1a24; color: #6b7280; flex-shrink: 0; }
    .rank-pos.gold { background: #fbbf2420; color: #fbbf24; }
    .rank-pos.silver { background: #9ca3af20; color: #9ca3af; }
    .rank-pos.bronze { background: #d9764020; color: #d97640; }
    .rank-body { flex: 1; min-width: 0; }
    .rank-name { font-size: 13px; font-weight: 600; color: #e5e7eb; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .rank-sub { font-size: 11px; color: #4b5563; }
    .rank-stat { text-align: right; flex-shrink: 0; }
    .rank-stat-val { font-size: 16px; font-weight: 700; font-variant-numeric: tabular-nums; }
    .rank-stat-val.green { color: #34d399; }
    .rank-stat-val.amber { color: #fbbf24; }
    .rank-stat-val.blue { color: #60a5fa; }
    .rank-stat-val.purple { color: #a78bfa; }
    .rank-stat-label { font-size: 9px; text-transform: uppercase; letter-spacing: 0.4px; color: #4b5563; }

    /* Table */
    table { width: 100%; border-collapse: collapse; font-size: 12px; }
    thead th { text-align: left; padding: 10px 12px; color: #4b5563; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; font-size: 10px; background: #0e0e16; border-bottom: 1px solid #1e1e2a; }
    tbody tr { border-bottom: 1px solid #141420; }
    tbody tr:last-child { border-bottom: none; }
    td { padding: 9px 12px; font-variant-numeric: tabular-nums; }
    .win { color: #34d399; font-weight: 600; }
    .loss { color: #f87171; font-weight: 600; }

    .empty-msg { color: #4b5563; text-align: center; padding: 28px; font-size: 12px; }
    .footer { text-align: center; padding: 28px; color: #27272f; font-size: 11px; }
    .footer a { color: #4b5563; }

    @media (max-width: 800px) { .grid { grid-template-columns: 1fr; } .card.wide { grid-column: 1; } .kpi-strip { flex-wrap: wrap; } }
  </style>
</head>
<body>

<div class="header">
  <div class="header-left">
    <h1>PolySignal</h1>
    <span class="badge">LEADERBOARD</span>
  </div>
  <div class="header-right">
    <a href="/" class="header-link">Dashboard</a>
    <a href="/stats.html" class="header-link">Performance</a>
    <a href="/terms.html" class="header-link">Terms</a>
  </div>
</div>

<div class="hero">
  <h2>Signal Leaderboard</h2>
  <p>Top-performing categories, markets, and signals ranked by win rate and edge.</p>
</div>

<div class="kpi-strip" id="kpiStrip">
  <div class="kpi-item"><div class="kpi-label">Total Settled</div><div class="kpi-value blue" id="kTotal">-</div><div class="kpi-sub">signals resolved</div></div>
  <div class="kpi-item"><div class="kpi-label">Best Win Streak</div><div class="kpi-value green" id="kBestStreak">-</div><div class="kpi-sub">consecutive wins</div></div>
  <div class="kpi-item"><div class="kpi-label">Current Streak</div><div class="kpi-value amber" id="kCurStreak">-</div><div class="kpi-sub">in a row</div></div>
  <div class="kpi-item"><div class="kpi-label">Top Category</div><div class="kpi-value purple" id="kTopCat">-</div><div class="kpi-sub" id="kTopCatSub">win rate</div></div>
</div>

<div class="grid">
  <!-- Category Rankings -->
  <div class="card">
    <div class="card-title">Category Rankings</div>
    <div id="catRankings"><div class="empty-msg">Loading...</div></div>
  </div>

  <!-- Streak Board -->
  <div class="card">
    <div class="card-title">Best Win Streaks by Category</div>
    <div id="streakBoard"><div class="empty-msg">Loading...</div></div>
  </div>

  <!-- Top Edge Wins -->
  <div class="card wide">
    <div class="card-title">Highest-Edge Winning Signals</div>
    <div style="overflow-x:auto">
      <table>
        <thead><tr><th>Market</th><th>Category</th><th>Side</th><th>Edge</th><th>Confidence</th><th>P&L</th><th>Date</th></tr></thead>
        <tbody id="edgeBody"><tr><td colspan="7" class="empty-msg">Loading...</td></tr></tbody>
      </table>
    </div>
  </div>

  <!-- Top Markets -->
  <div class="card wide">
    <div class="card-title">Top Markets by Win Rate</div>
    <div style="overflow-x:auto">
      <table>
        <thead><tr><th>Market</th><th>Category</th><th>Signals</th><th>Wins</th><th>Win Rate</th><th>Total P&L</th></tr></thead>
        <tbody id="marketsBody"><tr><td colspan="6" class="empty-msg">Loading...</td></tr></tbody>
      </table>
    </div>
  </div>
</div>

<div class="footer">
  PolySignal &mdash; AI-powered Polymarket signal scanner &mdash; <a href="/">Back to Dashboard</a>
</div>

<script>
const $ = (id) => document.getElementById(id);

async function loadLeaderboard() {
  try {
    const data = await fetch("/api/leaderboard").then(r => r.json());
    renderKPIs(data);
    renderCategoryRankings(data.categories);
    renderStreakBoard(data.streakBoard);
    renderTopEdgeWins(data.topEdgeWins);
    renderTopMarkets(data.topMarkets);
  } catch (err) {
    console.error("Failed to load leaderboard:", err);
  }
}

function renderKPIs(d) {
  $("kTotal").textContent = d.totalSettled ?? 0;
  $("kBestStreak").textContent = d.bestWinStreak ?? 0;
  $("kCurStreak").textContent = d.currentWinStreak ?? 0;
  if (d.categories && d.categories.length > 0) {
    const top = d.categories[0];
    $("kTopCat").textContent = esc(top.category || "other");
    $("kTopCat").style.fontSize = (top.category || "").length > 8 ? "18px" : "26px";
    $("kTopCatSub").textContent = (top.win_rate ?? 0) + "% win rate";
  }
}

function renderCategoryRankings(cats) {
  const el = $("catRankings");
  if (!cats || cats.length === 0) { el.innerHTML = '<div class="empty-msg">No settled signals yet</div>'; return; }
  el.innerHTML = cats.map((c, i) => {
    const posClass = i === 0 ? "gold" : i === 1 ? "silver" : i === 2 ? "bronze" : "";
    const settled = (c.wins || 0) + (c.losses || 0);
    return `<div class="rank-row">
      <div class="rank-pos ${posClass}">${i + 1}</div>
      <div class="rank-body">
        <div class="rank-name">${esc(c.category || "other")}</div>
        <div class="rank-sub">${settled} settled &middot; ${c.wins}W / ${c.losses}L &middot; avg edge ${((c.avg_edge ?? 0) * 100).toFixed(1)}%</div>
      </div>
      <div class="rank-stat">
        <div class="rank-stat-val ${(c.win_rate ?? 0) >= 55 ? "green" : (c.win_rate ?? 0) >= 45 ? "amber" : "loss"}">${c.win_rate ?? 0}%</div>
        <div class="rank-stat-label">Win Rate</div>
      </div>
    </div>`;
  }).join("");
}

function renderStreakBoard(streaks) {
  const el = $("streakBoard");
  if (!streaks || streaks.length === 0) { el.innerHTML = '<div class="empty-msg">No win streaks yet</div>'; return; }
  el.innerHTML = streaks.map((s, i) => {
    const posClass = i === 0 ? "gold" : i === 1 ? "silver" : i === 2 ? "bronze" : "";
    return `<div class="rank-row">
      <div class="rank-pos ${posClass}">${i + 1}</div>
      <div class="rank-body">
        <div class="rank-name">${esc(s.category || "other")}</div>
        <div class="rank-sub">best consecutive wins in category</div>
      </div>
      <div class="rank-stat">
        <div class="rank-stat-val purple">${s.streak}</div>
        <div class="rank-stat-label">Streak</div>
      </div>
    </div>`;
  }).join("");
}

function renderTopEdgeWins(signals) {
  const el = $("edgeBody");
  if (!signals || signals.length === 0) { el.innerHTML = '<tr><td colspan="7" class="empty-msg">No winning signals yet</td></tr>'; return; }
  el.innerHTML = signals.map(s => {
    const side = s.side === "UP" ? "YES" : "NO";
    const edge = s.edge != null ? "+" + (s.edge * 100).toFixed(1) + "%" : "-";
    const pnl = s.pnl_pct != null ? (s.pnl_pct >= 0 ? "+" : "") + (s.pnl_pct * 100).toFixed(1) + "%" : "-";
    const dt = s.created_at ? new Date(s.created_at).toLocaleDateString() : "-";
    return `<tr>
      <td style="max-width:280px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${esc((s.question || "").slice(0, 60))}</td>
      <td>${esc(s.category || "other")}</td>
      <td>${side}</td>
      <td class="win">${edge}</td>
      <td>${s.confidence ?? "-"}</td>
      <td class="${(s.pnl_pct ?? 0) >= 0 ? "win" : "loss"}">${pnl}</td>
      <td style="color:#6b7280">${dt}</td>
    </tr>`;
  }).join("");
}

function renderTopMarkets(markets) {
  const el = $("marketsBody");
  if (!markets || markets.length === 0) { el.innerHTML = '<tr><td colspan="6" class="empty-msg">No market data yet</td></tr>'; return; }
  el.innerHTML = markets.map(m => {
    const settled = (m.wins || 0) + (m.losses || 0);
    const pnl = m.total_pnl != null ? (m.total_pnl >= 0 ? "+" : "") + (m.total_pnl * 100).toFixed(1) + "%" : "-";
    return `<tr>
      <td style="max-width:280px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${esc((m.question || "").slice(0, 60))}</td>
      <td>${esc(m.category || "other")}</td>
      <td>${settled}</td>
      <td class="win">${m.wins || 0}</td>
      <td>${m.win_rate ?? 0}%</td>
      <td class="${(m.total_pnl ?? 0) >= 0 ? "win" : "loss"}">${pnl}</td>
    </tr>`;
  }).join("");
}

function esc(s) { if (!s) return ""; const el = document.createElement("span"); el.textContent = s; return el.innerHTML; }

loadLeaderboard();
</script>
</body>
</html>
